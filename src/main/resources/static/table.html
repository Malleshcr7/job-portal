<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Daily Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Added Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: #ffffff;
            --shadow-light: rgba(136, 165, 191, 0.48);
            --shadow-dark: rgba(255, 255, 255, 0.8);
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --accent-color: #3498db;
            --accent-hover: #2980b9;
            --success-color: #2ecc71;
            --success-hover: #27ae60;
            --warning-color: #e67e22;
            --warning-hover: #d35400;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --border-radius: 15px;
            --font-family: 'Poppins', sans-serif;
            --border-color: #e0e6ed;
        }

        /* --- General Styling --- */
        body {
            font-family: var(--font-family); background: var(--bg-gradient); min-height: 100vh;
            margin: 0; padding: 30px; color: var(--primary-text); box-sizing: border-box;
            overflow-x: hidden;
        }
        .header { text-align: center; margin-bottom: 40px; }
        h1 { font-weight: 700; font-size: 2.5em; }
        p.subtitle { font-size: 1.1em; color: var(--secondary-text); }

        /* --- Grid Layout --- */
        .schedule-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px; max-width: 1400px; margin: auto;
        }

        /* --- Schedule Card Styling --- */
        /* NEW: Added animation for cards loading */
        @keyframes cardEnter {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .schedule-card {
            background-color: var(--card-bg); border-radius: var(--border-radius);
            box-shadow: 6px 6px 16px var(--shadow-light), -6px -6px 16px var(--shadow-dark);
            border: 1px solid var(--border-color); padding: 25px;
            display: flex; flex-direction: column; position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0; /* Start hidden for animation */
            animation: cardEnter 0.5s ease-out forwards;
        }
        .schedule-card:hover { transform: translateY(-8px); box-shadow: 10px 10px 20px var(--shadow-light), -10px -10px 20px var(--shadow-dark); }
        .card-time { font-size: 0.9em; font-weight: 600; color: var(--accent-color); margin-bottom: 8px; }
        .card-title { font-size: 1.6em; font-weight: 600; margin: 0 0 15px 0; word-wrap: break-word; }
        .card-image { width: 100%; height: 180px; object-fit: cover; border-radius: 10px; margin-bottom: 15px; display: none; }
        .card-placeholder {
            height: 180px; border: 2px dashed #e0e0e0; border-radius: 10px; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center; color: var(--secondary-text); font-style: italic;
        }

        .card-timer {
            font-size: 1.8em; font-weight: 600; text-align: center; margin: 10px 0 15px;
            color: var(--primary-text); letter-spacing: 2px; font-family: monospace; display: none;
        }
        .card-controls-container { display: flex; gap: 10px; margin-bottom: 15px; }
        .timer-button {
             flex-grow: 1; padding: 8px 14px; border: none; border-radius: 8px;
             font-weight: 600; cursor: pointer; transition: all 0.2s ease;
        }
        .timer-toggle-btn { background-color: var(--accent-color); color: white; }
        .timer-toggle-btn:hover { background-color: var(--accent-hover); }
        .timer-toggle-btn.running { background-color: var(--warning-color); }
        .timer-toggle-btn.running:hover { background-color: var(--warning-hover); }
        .timer-reset-btn { background-color: transparent; color: var(--danger-color); border: 1px solid var(--danger-color); }
        .timer-reset-btn:hover { background-color: var(--danger-color); color: white; }

        .card-button-container { margin-top: auto; padding-top: 15px; border-top: 1px solid #f0f0f0; min-height: 40px; display: flex; flex-wrap: wrap; gap: 8px; }
        .run-button {
            background-color: var(--success-color); color: white; border: none; padding: 8px 14px;
            border-radius: 8px; cursor: pointer; font-weight: 600;
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px;
        }
        .run-button:hover { background-color: var(--success-hover); transform: translateY(-2px); }
        .run-button i { font-size: 0.9em; }

        .edit-btn {
            position: absolute; top: 15px; right: 15px; width: 40px; height: 40px; border-radius: 50%;
            background-color: #f0f0f0; border: none; cursor: pointer; display: flex; align-items: center;
            justify-content: center; transition: all 0.2s ease;
        }
        .edit-btn:hover { background-color: var(--accent-color); transform: scale(1.1) rotate(15deg); }
        .edit-btn svg { width: 20px; height: 20px; stroke: var(--primary-text); transition: stroke 0.2s ease; }
        .edit-btn:hover svg { stroke: white; }

        /* --- NEW: Modal Animations & Styling --- */
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: #fefefe; padding: 30px 40px; border-radius: var(--border-radius);
            width: 90%; max-width: 650px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.4s ease-out; max-height: 90vh; overflow-y: auto;
        }
        .close-btn {
            position: absolute; top: 10px; right: 10px; width: 40px; height: 40px;
            font-size: 22px; color: var(--secondary-text); background-color: transparent; border: none;
            cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s, color 0.2s, transform 0.2s;
        }
        .close-btn:hover { background-color: #f0f0f0; color: var(--primary-text); transform: rotate(90deg); }
        .modal-content h3 { color: var(--primary-text); text-align: center; margin-bottom: 25px; }
        .modal-content label { font-weight: 600; display: block; margin: 15px 0 8px; }
        .modal-content input, .modal-content textarea {
            width: 96%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;
            font-family: var(--font-family); transition: border-color 0.2s, box-shadow 0.2s;
        }
        .modal-content input:focus, .modal-content textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        .modal-content textarea { min-height: 80px; }
        .modal-image-preview { max-width: 100%; max-height: 200px; display: none; margin-top: 10px; border-radius: 8px;}

        /* --- NEW: Button Management in Modal --- */
        .modal-section { border: 1px solid #eee; border-radius: 10px; padding: 20px; margin-top: 25px; }
        .modal-section-title { font-weight: 600; margin: 0 0 15px 0; color: var(--primary-text); }

        #modal-existing-buttons-list { margin-top: 15px; display: flex; flex-direction: column; gap: 10px; }
        .modal-button-item {
            background-color: #f9f9f9; border: 1px solid #eee; border-radius: 8px; padding: 10px 15px;
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .button-item-info { display: flex; align-items: center; gap: 10px; word-break: break-all; }
        .button-item-info i { color: var(--secondary-text); }
        .button-item-name { font-weight: 600; }
        .button-item-controls .icon-btn {
            background: none; border: none; cursor: pointer; color: var(--secondary-text); font-size: 16px;
            width: 30px; height: 30px; border-radius: 50%;
            transition: background-color 0.2s, color 0.2s;
        }
        .button-item-controls .icon-btn.edit:hover { background-color: #e0f7fa; color: #007bff; }
        .button-item-controls .icon-btn.delete:hover { background-color: #ffebee; color: var(--danger-color); }
        .action-button {
            background-color: var(--success-color); color: white; padding: 10px 20px; border: none;
            border-radius: 8px; cursor: pointer; font-size: 15px; margin-top: 20px; font-weight: 600;
            display: inline-block; transition: background-color 0.2s;
        }
        .action-button:hover { background-color: var(--success-hover); }

        /* Main Save Button */
        .save-btn {
            background: var(--accent-color); color: white; padding: 14px 25px; border: none;
            border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 30px; font-weight: 600;
            display: block; width: 100%; transition: background-color 0.2s, transform 0.2s;
        }
        .save-btn:hover { background-color: var(--accent-hover); transform: scale(1.02); }
    </style>
</head>
<body>

<div class="header">
    <h1>Daily Dashboard</h1>
    <p class="subtitle">Your changes are automatically saved. Click the pencil icon to edit any schedule.</p>
</div>

<div class="schedule-grid">
    <!-- Cards are dynamically generated by JavaScript below -->
</div>

<!-- The Modal (Pop-up Editor) -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeEditModal()" title="Close">&times;</button>
        <h3>Edit Schedule Details</h3>
        <input type="hidden" id="modal-editing-id">

        <label for="modal-title-input">Title:</label>
        <input type="text" id="modal-title-input" placeholder="e.g., Morning Workout">

        <label for="modal-time-input">Time:</label>
        <input type="text" id="modal-time-input" placeholder="e.g., 7:00 AM - 8:00 AM">

        <label for="modal-image-input">Upload Image:</label>
        <input type="file" id="modal-image-input" accept="image/*" onchange="previewImageInModal(event)">
        <img id="modal-image-preview" class="modal-image-preview" src="">

        <!-- NEW: Redesigned Button Management Section -->
        <div class="modal-section">
            <h4 class="modal-section-title">Manage Custom Actions</h4>

            <div id="modal-existing-buttons-list">
                <!-- Existing buttons will be populated here by JS -->
            </div>

            <div class="modal-section" style="margin-top: 20px; padding: 20px; background: #fdfdfd;">
                <h4 class="modal-section-title" id="action-editor-title">Add New Action</h4>
                <input type="hidden" id="editing-button-index">

                <label for="modal-button-name-input">Display Name:</label>
                <input type="text" id="modal-button-name-input" placeholder="e.g., Open Website">

                <label for="modal-link-input" style="margin-top:10px;">Action Type (Provide ONE):</label>
                <p style="margin:5px 0 5px; font-size:0.9em; color: var(--secondary-text);">Open a Link/URL</p>
                <input type="url" id="modal-link-input" placeholder="https://example.com">

                <p style="margin:15px 0 5px; font-size:0.9em; color: var(--secondary-text);">Or, Run an HTML Snippet</p>
                <textarea id="modal-html-input" placeholder="Paste HTML code here..."></textarea>

                <button class="action-button" onclick="saveActionInModal()" id="save-action-btn">Add Action</button>
            </div>
        </div>

        <button class="save-btn" onclick="saveChanges()">Save All Changes & Close</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        const grid = document.querySelector('.schedule-grid');
        // Generate the 9 schedule card placeholders
        for (let i = 1; i <= 9; i++) {
            grid.innerHTML += `
            <div class="schedule-card" id="card-${i}">
                <button class="edit-btn" onclick="openEditModal(${i})" aria-label="Edit Schedule ${i}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                    </svg>
                </button>
                <span class="card-time" id="time-${i}">Set Time</span>
                <h2 class="card-title" id="title-${i}">Schedule ${i}</h2>
                <div class="card-placeholder" id="placeholder-${i}">No Image Uploaded</div>
                <img class="card-image" id="image-${i}" src="" alt="Schedule Image">

                <div class="card-timer" id="timer-display-${i}">00:00:00</div>
                <div class="card-controls-container" id="timer-controls-${i}">
                    <button class="timer-button timer-toggle-btn" onclick="toggleTimer(${i})">Start Timer</button>
                    <button class="timer-button timer-reset-btn" style="display: none;" onclick="resetTimer(${i})">Reset</button>
                </div>

                <div class="card-button-container" id="buttons-${i}"></div>
            </div>`;
        }

        loadDashboardFromStorage();

        // Staggered card animation
        const cards = document.querySelectorAll('.schedule-card');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 70}ms`;
        });

    });

        // Modal Elements
        const modal = document.getElementById('editModal');
        const modalEditingId = document.getElementById('modal-editing-id');
        const modalTitleInput = document.getElementById('modal-title-input');
        const modalTimeInput = document.getElementById('modal-time-input');
        const modalImagePreview = document.getElementById('modal-image-preview');
        const modalImageInput = document.getElementById('modal-image-input');

        // Modal Button Editor Elements
        const editingButtonIndexInput = document.getElementById('editing-button-index');
        const actionEditorTitle = document.getElementById('action-editor-title');
        const saveActionButton = document.getElementById('save-action-btn');
        const modalButtonNameInput = document.getElementById('modal-button-name-input');
        const modalLinkInput = document.getElementById('modal-link-input');
        const modalHtmlInput = document.getElementById('modal-html-input');
        const existingButtonsList = document.getElementById('modal-existing-buttons-list');

        const cardTimers = {}; // Object to store timer states

        function saveDashboardToStorage() {
            const dashboardData = [];
            for (let i = 1; i <= 9; i++) {
                const cardData = {
                    id: i,
                    title: document.getElementById(`title-${i}`).textContent,
                    time: document.getElementById(`time-${i}`).textContent,
                    image: document.getElementById(`image-${i}`).src,
                    buttons: []
                };

                const buttonContainer = document.getElementById(`buttons-${i}`);
                buttonContainer.querySelectorAll('.run-button').forEach(button => {
                    cardData.buttons.push({
                        name: button.textContent.trim(),
                        type: button.dataset.actionType,
                        content: button.dataset.actionContent
                    });
                });
                dashboardData.push(cardData);
            }
            localStorage.setItem('myDashboardData', JSON.stringify(dashboardData));
        }

        function loadDashboardFromStorage() {
            const savedData = localStorage.getItem('myDashboardData');
            if (!savedData) return;

            const dashboardData = JSON.parse(savedData);
            dashboardData.forEach(cardData => {
                const id = cardData.id;
                document.getElementById(`title-${id}`).textContent = cardData.title;
                document.getElementById(`time-${id}`).textContent = cardData.time;

                if (cardData.image && !cardData.image.endsWith('/')) {
                    document.getElementById(`image-${id}`).src = cardData.image;
                    document.getElementById(`image-${id}`).style.display = 'block';
                    document.getElementById(`placeholder-${id}`).style.display = 'none';
                }

                const buttonContainer = document.getElementById(`buttons-${id}`);
                buttonContainer.innerHTML = '';
                if(cardData.buttons) {
                    cardData.buttons.forEach(buttonInfo => {
                        createRunButtonOnCard(buttonContainer, buttonInfo.name, buttonInfo.type, buttonInfo.content);
                    });
                }
            });
        }

        function createRunButtonOnCard(container, name, type, content) {
            const newButton = document.createElement('button');
            newButton.className = 'run-button';
            newButton.dataset.actionType = type;
            newButton.dataset.actionContent = content;

            const iconClass = type === 'url' ? 'fa-solid fa-arrow-up-right-from-square' : 'fa-solid fa-code';
            newButton.innerHTML = `<i class="${iconClass}"></i> ${name}`;

            newButton.onclick = () => runAction(newButton);
            container.appendChild(newButton);
        }

        function runAction(buttonElement) {
            const type = buttonElement.dataset.actionType;
            const content = buttonElement.dataset.actionContent;

            if (type === 'url') {
                try {
                    let url = content;
                    if (!/^https?:\/\//i.test(url)) {
                       url = 'https://' + url;
                    }
                    window.open(url, '_blank', 'noopener,noreferrer');
                } catch (e) {
                     alert('Could not open the link. Pop-ups might be blocked by your browser.');
                }
            } else if (type === 'snippet') {
                runHtmlSnippet(content);
            }
        }

        function runHtmlSnippet(code) {
            try {
                const newWindow = window.open();
                newWindow.document.write(code);
                newWindow.document.close();
            } catch (e) {
                alert('Could not open window. Pop-ups might be blocked by your browser.');
            }
        }

        function openEditModal(scheduleId) {
            modalEditingId.value = scheduleId;
            modalTitleInput.value = document.getElementById(`title-${scheduleId}`).textContent;
            modalTimeInput.value = document.getElementById(`time-${scheduleId}`).textContent;

            const currentImageSrc = document.getElementById(`image-${scheduleId}`).src;
            modalImagePreview.src = currentImageSrc;
            modalImagePreview.style.display = currentImageSrc && !currentImageSrc.endsWith('/') ? 'block' : 'none';

            // NEW: Populate existing buttons for editing
            existingButtonsList.innerHTML = '';
            const cardButtons = document.querySelectorAll(`#buttons-${scheduleId} .run-button`);
            cardButtons.forEach((button, index) => {
                const name = button.textContent.trim();
                const type = button.dataset.actionType;
                const content = button.dataset.actionContent;
                addButtonToList(name, type, content, index);
            });

            modal.style.display = "flex";
            modalTitleInput.focus();
        }

        function closeEditModal() {
            modal.style.display = "none";
            // Clear all inputs and reset form
            modalHtmlInput.value = '';
            modalButtonNameInput.value = '';
            modalLinkInput.value = '';
            modalImageInput.value = null;
            modalImagePreview.style.display = 'none';
            modalImagePreview.src = '';
            existingButtonsList.innerHTML = '';
            resetActionEditor();
        }

        function saveChanges() {
            const currentId = modalEditingId.value;
            if (!currentId) return;
            // Save Title, Time, Image
            document.getElementById(`title-${currentId}`).textContent = modalTitleInput.value || `Schedule ${currentId}`;
            document.getElementById(`time-${currentId}`).textContent = modalTimeInput.value || 'Set Time';

            const modalImgSrc = modalImagePreview.src;
            if (modalImgSrc && !modalImgSrc.endsWith('/') && modalImgSrc !== window.location.href) {
                document.getElementById(`image-${currentId}`).src = modalImgSrc;
                document.getElementById(`image-${currentId}`).style.display = 'block';
                document.getElementById(`placeholder-${currentId}`).style.display = 'none';
            }

            // NEW: Re-build buttons from the modal list to the card
            const buttonContainer = document.getElementById(`buttons-${currentId}`);
            buttonContainer.innerHTML = '';
            existingButtonsList.querySelectorAll('.modal-button-item').forEach(item => {
                const { name, type, content } = item.dataset;
                createRunButtonOnCard(buttonContainer, name, type, content);
            });

            closeEditModal();
            saveDashboardToStorage();
        }

        function previewImageInModal(event) {
            if (event.target.files && event.target.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    modalImagePreview.src = e.target.result;
                    modalImagePreview.style.display = 'block';
                }
                reader.readAsDataURL(event.target.files[0]);
            }
        }

        // --- NEW Button Management Functions ---
        function resetActionEditor() {
            editingButtonIndexInput.value = '';
            modalButtonNameInput.value = '';
            modalLinkInput.value = '';
            modalHtmlInput.value = '';
            actionEditorTitle.textContent = 'Add New Action';
            saveActionButton.textContent = 'Add Action';
            document.querySelectorAll('.modal-button-item').forEach(item => item.style.backgroundColor = '#f9f9f9');
        }

        function addButtonToList(name, type, content, index) {
            const iconClass = type === 'url' ? 'fa-solid fa-link' : 'fa-solid fa-code';
            const listItem = document.createElement('div');
            listItem.className = 'modal-button-item';
            listItem.dataset.name = name;
            listItem.dataset.type = type;
            listItem.dataset.content = content;
            listItem.dataset.index = index;

            listItem.innerHTML = `
                <div class="button-item-info">
                    <i class="${iconClass}"></i>
                    <span class="button-item-name">${name}</span>
                </div>
                <div class="button-item-controls">
                    <button class="icon-btn edit" onclick="editActionInModal(this)" title="Edit"><i class="fa-solid fa-pencil"></i></button>
                    <button class="icon-btn delete" onclick="deleteActionInModal(this)" title="Delete"><i class="fa-solid fa-trash-can"></i></button>
                </div>`;
            existingButtonsList.appendChild(listItem);
        }

        function editActionInModal(editBtn) {
            resetActionEditor();
            const listItem = editBtn.closest('.modal-button-item');
            listItem.style.backgroundColor = '#eef7ff'; // Highlight the item being edited

            const { name, type, content, index } = listItem.dataset;

            editingButtonIndexInput.value = index;
            actionEditorTitle.textContent = 'Editing Action';
            saveActionButton.textContent = 'Update Action';

            modalButtonNameInput.value = name;
            if (type === 'url') {
                modalLinkInput.value = content;
            } else {
                modalHtmlInput.value = content;
            }
        }

        function deleteActionInModal(deleteBtn) {
            if (confirm('Are you sure you want to delete this action?')) {
                deleteBtn.closest('.modal-button-item').remove();
                resetActionEditor();
            }
        }

        function saveActionInModal() {
            const linkUrl = modalLinkInput.value.trim();
            const htmlCode = modalHtmlInput.value.trim();
            const buttonName = modalButtonNameInput.value.trim() || (linkUrl ? 'Open Link' : 'Run Snippet');

            if (!linkUrl && !htmlCode) return alert('Please provide a URL or an HTML snippet.');
            if (linkUrl && htmlCode) return alert('Please provide only a URL or an HTML snippet, not both.');

            const type = linkUrl ? 'url' : 'snippet';
            const content = linkUrl || htmlCode;

            const editingIndex = editingButtonIndexInput.value;
            if (editingIndex) {
                // Update existing item
                const listItem = existingButtonsList.querySelector(`.modal-button-item[data-index='${editingIndex}']`);
                listItem.dataset.name = buttonName;
                listItem.dataset.type = type;
                listItem.dataset.content = content;
                listItem.querySelector('.button-item-name').textContent = buttonName;
                listItem.querySelector('.button-item-info i').className = type === 'url' ? 'fa-solid fa-link' : 'fa-solid fa-code';
            } else {
                // Add new item
                const newIndex = existingButtonsList.children.length;
                addButtonToList(buttonName, type, content, newIndex);
            }
            resetActionEditor();
        }

        /* --- Timer Functionality (Unchanged) --- */
        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        function updateTimer(cardId) {
            const timerState = cardTimers[cardId];
            if (!timerState || !timerState.isRunning) return;
            const elapsedTime = Date.now() - timerState.startTime;
            const totalTime = timerState.accumulatedTime + elapsedTime;
            document.getElementById(`timer-display-${cardId}`).textContent = formatTime(totalTime);
        }

        function toggleTimer(cardId) {
            if (!cardTimers[cardId]) {
                cardTimers[cardId] = { accumulatedTime: 0, isRunning: false, intervalId: null, startTime: 0 };
            }
            const timerState = cardTimers[cardId];
            const toggleButton = document.querySelector(`#card-${cardId} .timer-toggle-btn`);
            const resetButton = document.querySelector(`#card-${cardId} .timer-reset-btn`);
            const timerDisplay = document.getElementById(`timer-display-${cardId}`);
            timerDisplay.style.display = 'block';
            resetButton.style.display = 'inline-block';
            timerState.isRunning = !timerState.isRunning;
            if (timerState.isRunning) {
                timerState.startTime = Date.now();
                timerState.intervalId = setInterval(() => updateTimer(cardId), 1000);
                toggleButton.textContent = 'Pause';
                toggleButton.classList.add('running');
            } else {
                clearInterval(timerState.intervalId);
                timerState.accumulatedTime += Date.now() - timerState.startTime;
                toggleButton.textContent = 'Resume';
                toggleButton.classList.remove('running');
            }
        }

        function resetTimer(cardId) {
            const timerState = cardTimers[cardId];
            if (!timerState) return;
            clearInterval(timerState.intervalId);
            delete cardTimers[cardId];
            document.getElementById(`timer-display-${cardId}`).textContent = '00:00:00';
            document.getElementById(`timer-display-${cardId}`).style.display = 'none';
            const toggleButton = document.querySelector(`#card-${cardId} .timer-toggle-btn`);
            toggleButton.textContent = 'Start Timer';
            toggleButton.classList.remove('running');
            document.querySelector(`#card-${cardId} .timer-reset-btn`).style.display = 'none';
        }

        window.onclick = event => { if (event.target == modal) closeEditModal(); }
</script>

</body>
</html>